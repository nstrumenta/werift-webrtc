{"version":3,"file":"webm.js","sourceRoot":"","sources":["../../../../src/processor/webm.ts"],"names":[],"mappings":"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","sourcesContent":["import debug from \"debug\";\n\nimport {\n  getEBMLByteLength,\n  numberToByteArray,\n  vintEncode,\n} from \"../container/ebml\";\nimport { SupportedCodec, WEBMBuilder } from \"../container/webm\";\n\nconst sourcePath = `werift-rtp : packages/rtp/src/processor/webm.ts`;\nconst log = debug(sourcePath);\n\nexport type WebmInput = {\n  frame?: {\n    data: Buffer;\n    isKeyframe: boolean;\n    /**ms */\n    time: number;\n  };\n  eol?: boolean;\n};\n\nexport type WebmOutput = {\n  saveToFile?: Buffer;\n  kind?: \"initial\" | \"cluster\" | \"block\" | \"cuePoints\";\n  previousDuration?: number;\n  eol?: {\n    /**ms */\n    duration: number;\n    durationElement: Uint8Array;\n  };\n};\n\nexport interface WebmOption {\n  /**ms */\n  duration?: number;\n  encryptionKey?: Buffer;\n  strictTimestamp?: boolean;\n}\n\nexport class WebmBase {\n  private builder: WEBMBuilder;\n  private relativeTimestamp = 0;\n  private timestamps: { [pt: number]: ClusterTimestamp } = {};\n  private cuePoints: CuePoint[] = [];\n  private position = 0;\n  private clusterCounts = 0;\n  stopped = false;\n  elapsed?: number;\n\n  constructor(\n    public tracks: {\n      width?: number;\n      height?: number;\n      kind: \"audio\" | \"video\";\n      codec: SupportedCodec;\n      clockRate: number;\n      trackNumber: number;\n    }[],\n    private output: (output: WebmOutput) => void,\n    private options: WebmOption = {}\n  ) {\n    this.builder = new WEBMBuilder(tracks, options.encryptionKey);\n\n    tracks.forEach((t) => {\n      this.timestamps[t.trackNumber] = new ClusterTimestamp();\n    });\n  }\n\n  private processInput(input: WebmInput, trackNumber: number) {\n    if (this.stopped) return;\n    if (!input.frame) {\n      if (input.eol) {\n        this.stop();\n      }\n      return;\n    }\n\n    this.onFrameReceived({ ...input.frame, trackNumber });\n  }\n\n  processAudioInput = (input: WebmInput) => {\n    const track = this.tracks.find((t) => t.kind === \"audio\");\n    if (track) {\n      this.processInput(input, track.trackNumber);\n    }\n  };\n\n  processVideoInput = (input: WebmInput) => {\n    const track = this.tracks.find((t) => t.kind === \"video\");\n    if (track) {\n      this.processInput(input, track.trackNumber);\n    }\n  };\n\n  protected start() {\n    const staticPart = Buffer.concat([\n      this.builder.ebmlHeader,\n      this.builder.createSegment(this.options.duration),\n    ]);\n    this.output({ saveToFile: staticPart, kind: \"initial\" });\n    this.position += staticPart.length;\n\n    const video = this.tracks.find((t) => t.kind === \"video\");\n    if (video) {\n      this.cuePoints.push(\n        new CuePoint(this.builder, video.trackNumber, 0.0, this.position)\n      );\n    }\n  }\n\n  private onFrameReceived(frame: WebmInput[\"frame\"] & { trackNumber: number }) {\n    const track = this.tracks.find((t) => t.trackNumber === frame.trackNumber);\n    if (!track) {\n      return;\n    }\n\n    const timestampManager = this.timestamps[track.trackNumber];\n    if (timestampManager.baseTime == undefined) {\n      for (const t of Object.values(this.timestamps)) {\n        t.baseTime = frame.time;\n      }\n    }\n\n    // clusterの経過時間\n    let elapsed = timestampManager.update(frame.time);\n\n    if (this.clusterCounts === 0) {\n      this.createCluster(0.0, 0);\n    } else if (\n      (track.kind === \"video\" && frame.isKeyframe) ||\n      elapsed > MaxSinged16Int\n    ) {\n      this.relativeTimestamp += elapsed;\n\n      if (elapsed !== 0) {\n        this.cuePoints.push(\n          new CuePoint(\n            this.builder,\n            track.trackNumber,\n            this.relativeTimestamp,\n            this.position\n          )\n        );\n\n        this.createCluster(this.relativeTimestamp, elapsed);\n        Object.values(this.timestamps).forEach((t) => t.shift(elapsed));\n        elapsed = timestampManager.update(frame.time);\n      }\n    }\n\n    if (elapsed >= 0) {\n      this.createSimpleBlock({\n        frame,\n        trackNumber: track.trackNumber,\n        elapsed,\n      });\n    } else {\n      log(\"delayed frame\", { elapsed });\n    }\n  }\n\n  private createCluster(timestamp: number, duration: number) {\n    const cluster = this.builder.createCluster(timestamp);\n    this.clusterCounts++;\n    this.output({\n      saveToFile: Buffer.from(cluster),\n      kind: \"cluster\",\n      previousDuration: duration,\n    });\n    this.position += cluster.length;\n    this.elapsed = undefined;\n  }\n\n  private createSimpleBlock({\n    frame,\n    trackNumber,\n    elapsed,\n  }: {\n    frame: NonNullable<WebmInput[\"frame\"]>;\n    trackNumber: number;\n    elapsed: number;\n  }) {\n    if (this.elapsed == undefined) {\n      this.elapsed = elapsed;\n    }\n    if (elapsed < this.elapsed && this.options.strictTimestamp) {\n      log(\"previous timestamp\", {\n        elapsed,\n        present: this.elapsed,\n        trackNumber,\n      });\n      return;\n    }\n    this.elapsed = elapsed;\n\n    const block = this.builder.createSimpleBlock(\n      frame.data,\n      frame.isKeyframe,\n      trackNumber,\n      elapsed\n    );\n    this.output({ saveToFile: block, kind: \"block\" });\n    this.position += block.length;\n    const [cuePoint] = this.cuePoints.slice(-1);\n    if (cuePoint) {\n      cuePoint.blockNumber++;\n    }\n  }\n\n  private stop() {\n    if (this.stopped) {\n      return;\n    }\n    this.stopped = true;\n\n    log(\"stop\");\n\n    const cues = this.builder.createCues(this.cuePoints.map((c) => c.build()));\n    this.output({ saveToFile: Buffer.from(cues), kind: \"cuePoints\" });\n\n    const latestTimestamp = Object.values(this.timestamps).sort(\n      (a, b) => a.elapsed - b.elapsed\n    )[0].elapsed;\n    const duration = this.relativeTimestamp + latestTimestamp;\n    const durationElement = this.builder.createDuration(duration);\n    this.output({ eol: { duration, durationElement } });\n  }\n}\n\nclass ClusterTimestamp {\n  /**ms */\n  baseTime?: number;\n  /**ms */\n  elapsed = 0;\n  private offset = 0;\n\n  shift(\n    /**ms */\n    elapsed: number\n  ) {\n    this.offset += elapsed;\n  }\n\n  update(\n    /**ms */\n    time: number\n  ) {\n    if (this.baseTime == undefined) {\n      throw new Error(\"baseTime not exist\");\n    }\n\n    this.elapsed = time - this.baseTime - this.offset;\n\n    return this.elapsed;\n  }\n}\n\nclass CuePoint {\n  /**\n   * cuesの後のclusterのあるべき位置\n   * cuesはclusterの前に挿入される\n   */\n  cuesLength = 0;\n  blockNumber = 0;\n\n  constructor(\n    private readonly builder: WEBMBuilder,\n    private readonly trackNumber: number,\n    private readonly relativeTimestamp: number,\n    public position: number\n  ) {}\n\n  build() {\n    return this.builder.createCuePoint(\n      this.relativeTimestamp,\n      this.trackNumber,\n      this.position - 48 + this.cuesLength,\n      this.blockNumber\n    );\n  }\n}\n\n/**4294967295 */\nexport const Max32Uint = Number(0x01n << 32n) - 1;\n/**32767 */\nexport const MaxSinged16Int = (0x01 << 16) / 2 - 1;\n\nexport const DurationPosition = 0x83;\n\nexport const SegmentSizePosition = 0x40;\n\nexport function replaceSegmentSize(totalFileSize: number) {\n  const bodySize = totalFileSize - SegmentSizePosition;\n  const resize = [\n    ...vintEncode(numberToByteArray(bodySize, getEBMLByteLength(bodySize))),\n  ];\n  const todoFill = 8 - resize.length - 2;\n  if (todoFill > 0) {\n    resize.push(0xec);\n    if (todoFill > 1) {\n      const voidSize = vintEncode(\n        numberToByteArray(todoFill, getEBMLByteLength(todoFill))\n      );\n      [...voidSize].forEach((i) => resize.push(i));\n    }\n  }\n  return Buffer.from(resize);\n}\n"]}